<% if @quest.persisted? %>
  <%= turbo_stream.remove "empty-state" %>
  
  <%= turbo_stream.prepend "quest-list" do %>
    <div class="quest-item" id="quest_<%= @quest.id %>">
      <%= form_with model: @quest, url: toggle_quest_path(@quest), method: :patch, local: false, class: "quest-form-inline", data: { turbo: true } do |form| %>
        <label class="quest-checkbox">
          <input type="checkbox" onchange="this.form.submit();">
          <span class="checkmark"></span>
        </label>
      <% end %>
      
      <span class="quest-title">
        <%= @quest.title %>
      </span>
      
      <%= link_to quest_path(@quest), 
                  data: { turbo_method: :delete, turbo: true }, 
                  class: "delete-btn",
                  title: "Delete quest" do %>
        <i class="fas fa-trash"></i>
      <% end %>
    </div>
  <% end %>
  
  <%= turbo_stream.update "quest-count" do %>
    <%= render "quest_count" %>
  <% end %>
  
  <%= turbo_stream.update "add-quest-form" do %>
    <%= form_with model: Quest.new, local: false, class: "add-quest-form", data: { turbo: true } do |form| %>
      <div class="input-group">
        <%= form.text_field :title, placeholder: "Add new quest...", class: "add-quest-input", required: true %>
        <button type="submit" class="add-btn" title="Add Quest">
          <i class="fas fa-plus"></i>
        </button>
      </div>
    <% end %>
  <% end %>
<% else %>
  <%= turbo_stream.replace "quest-list" do %>
    <%= render "quest_list" %>
  <% end %>
<% end %>
